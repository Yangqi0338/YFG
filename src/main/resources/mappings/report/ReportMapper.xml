<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.base.sbc.module.report.mapper.ReportMapper">
    <select id="getHangTagReortList" resultType="com.base.sbc.module.report.vo.HangTagReportVo">
        select
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            t.bulk_style_no,
            t1.style_color_pic,
            t1.ware_code,
            t1.color_name,
            t1.color_code,
            concat(t1.ware_code, t1.color_code, tbs.sort) as defaultBarCode,
            t1.tag_price,
            t.product_name,
            ts.style_name,
            t1.devt_type_name,
            ts.brand_name,
            ts.year_name,
            ts.season_name,
            t1.band_name,
            ts.prod_category1st_name,
            ts.prod_category2nd_name,
            ts.prod_category3rd_name,
            t.down_content,
            t.ingredient,
            t.special_spec
        </if>
        FROM t_hang_tag t
        LEFT JOIN t_style_color t1 ON t.bulk_style_no = t1.style_no and t1.del_flag = 0
        LEFT JOIN t_style ts ON t1.style_id = ts.id and ts.del_flag = 0
        LEFT JOIN t_basicsdatum_size tbs ON FIND_IN_SET(tbs.id, ts.size_ids) > 0 and tbs.hangtags = ts.default_size and tbs.del_flag = 0
        ${ew.customSqlSegment}
    </select>


    <select id="getMaterialSupplierQuoteReporList" resultType="com.base.sbc.module.report.vo.MaterialSupplierQuoteVo">
        select
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            t.image_url,
            t.material_code_name,
            t.create_date,
            t.category1_name,
            t.category2_name,
            t.category3_name,
            t1.width_name,
            t.stock_unit_name,
            t.factory_composition,
            t.ingredient,
            CONCAT(t2.color_name,t2.color_code) as colorNameCode,
            t2.supplier_color_code,
            t1.supplier_name,
            t1.SUPPLIER_MATERIAL_CODE,
            t1.QUOTATION_PRICE,
            t1.production_day,
            t1.order_day,
            t.status,
            t1.fob,
            tss.search_term1 as supplierNameShort,
            t1.minimum_order_quantity,
            t1.minimum_order_quantity_color,
            t.remarks,
            concat(tss.search_term1,'-',t1.supplier_id) as supplierQuote,
            t1.supplier_id,
            t.gram_weight,
            t.material_code_old,
            t.distribute,
            t.material_code,
            t.year_name,
            t.season_name
        </if>
        FROM t_basicsdatum_material t
        LEFT JOIN t_basicsdatum_material_price t1 ON t.MATERIAL_CODE = t1.MATERIAL_CODE
        LEFT JOIN t_basicsdatum_material_color t2 ON t.MATERIAL_CODE = t2.material_code
        LEFT JOIN t_smp_supplier tss ON t1.supplier_id = tss.partner
        ${ew.customSqlSegment}
    </select>

    <select id="getStylePackBomListReport" resultType="com.base.sbc.module.report.vo.StylePackBomMaterialReportVo">
        SELECT
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            tsc.style_color_pic,
            tsc.style_no,
            tsc.color_name,
            ts.prod_category1st_name,
            ts.prod_category_name,
            tsc.devt_type_name,
            ts.style_name,
            ts.style_type_name,
            tsc.bom_status,
            tpb.image_url,
            tpb.material_code,
            tpb.supplier_material_code,
            tpb.material_name,
            tpb.gram_weight,
            tpb.ingredient as materialIngredient,
            tpb.remarks,
            tbm.year_name,
            tbm.season_name,
            tbm.brand_name,
            tbm.category1_name,
            tbm.category2_name,
            tbm.category3_name,
            concat(tpb.supplier_name,'-',tpb.supplier_id) as supplierName,
            tpb.translate,
            tpb.bulk_price,
            tpb.bulk_unit_use,
            tpb.stock_unit_name,
            tpb.planning_looss_rate,
            tpb.cost,
            tpb.collocation_name,
            tpb.unusable_flag,
            tpb.supplier_price,
            tbm.status,
            SUBSTRING_INDEX(ts.designer, ',', 1) as designer,
            ts.technician_name,
            ts.pattern_design_name,
            tht.ingredient as tagIngredient,
            tht.safty_title,
            tht.safty_type,
            tht.technologist_name,
            tht.product_name,
            tht.warm_tips,
            tht.washing_material_remarks_name,
            tht.execute_standard,
            tht.quality_grade,
            tht.storage_demand_name,
            tsp.control_confirm ,
            tsp.product_hangtag_confirm,
            tsp.control_hangtag_confirm,
            tht.status as design_check_confirm,
            tht.status as tech_check_confirm,
            tht.status as qc_check_confirm
        </if>
        FROM
        t_style_color tsc
        LEFT JOIN t_style ts ON ts.id = tsc.style_id and ts.del_flag = 0
        LEFT JOIN t_pack_info tpi ON tsc.id = tpi.style_color_id and tpi.del_flag = 0
        LEFT JOIN t_pack_bom_version tpbv ON tpbv.foreign_id = tpi.id and tpbv.status = 1 and tpbv.pack_type = 'packBigGoods' and tpbv.del_flag = 0
        INNER JOIN t_pack_bom tpb ON tpb.foreign_id = tpi.id and tpbv.id = tpb.bom_version_id and tpb.del_flag = 0
        LEFT JOIN t_basicsdatum_material tbm ON tbm.id = tpb.material_id  and tbm.del_flag = 0
        LEFT JOIN t_hang_tag tht ON tht.bulk_style_no = tsc.style_no and tht.del_flag = 0
        LEFT JOIN t_style_pricing tsp ON tsp.pack_id = tpi.id  and tsp.del_flag = 0
        ${ew.customSqlSegment}
    </select>

    <select id="getStyleSizeReport" resultType = "com.base.sbc.module.report.vo.StyleSizeReportVo">
        SELECT
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            t.brand_name,
            t.style_no,
            t.style_color_pic,
            t.color_name,
            t.year_name,
            t.season_name,
            t.band_name,
            t.prod_category1st_name,
            t.prod_category_name,
            t.prod_category2nd_name,
            t.prod_category3rd_name,
            t.part_name,
            t.method,
            SUM(t.`XXS#样衣尺寸`) as templateXSS,
            SUM(t.`XXS#成衣尺寸`) as garmentXSS,
            SUM(t.`XXS#洗后尺寸`) as washingXSS,

            SUM(t.`XS#样衣尺寸`) as templateXS,
            SUM(t.`XS#成衣尺寸`) as garmentXS,
            SUM(t.`XS#洗后尺寸`) as washingXS,

            SUM(t.`S#样衣尺寸`) as templateS,
            SUM(t.`S#成衣尺寸`) as garmentS,
            SUM(t.`S#洗后尺寸`) as washingS,

            SUM(t.`M#样衣尺寸`) as templateM,
            SUM(t.`M#成衣尺寸`) as garmentM,
            SUM(t.`M#洗后尺寸`) as washingM,

            SUM(t.`L#样衣尺寸`) as templateL,
            SUM(t.`L#成衣尺寸`) as garmentL,
            SUM(t.`L#洗后尺寸`) as washingL,

            SUM(t.`XL#样衣尺寸`) as templateXL,
            SUM(t.`XL#成衣尺寸`) as garmentXL,
            SUM(t.`XL#洗后尺寸`) as washingXL,

            SUM(t.`XXL#样衣尺寸`) as templateXXL,
            SUM(t.`XXL#成衣尺寸`) as garmentXXL,
            SUM(t.`XXL#洗后尺寸`) as washingXXL,

            SUM(t.`XXXL#样衣尺寸`) as templateXXXL,
            SUM(t.`XXXL#成衣尺寸`) as garmentXXXL,
            SUM(t.`XXXL#洗后尺寸`) as washingXXXL,

            SUM(t.`XXXXL#样衣尺寸`) as templateXXXXL,
            SUM(t.`XXXXL#成衣尺寸`) as garmentXXXXL,
            SUM(t.`XXXXL#洗后尺寸`) as washingXXXXL
        </if>
        FROM (select temp.id,
        temp.foreign_id,
        temp.brand_name,
        temp.style_no,
        temp.style_color_pic,
        temp.color_name,
        temp.year_name,
        temp.season_name,
        temp.band_name,
        temp.prod_category1st_name,
        temp.prod_category_name,
        temp.prod_category2nd_name,
        temp.prod_category3rd_name,
        temp.part_name,
        temp.method,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXS') THEN temp.template ELSE 0 END AS `XXS#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXS') THEN temp.garment ELSE 0 END AS `XXS#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXS') THEN temp.washing ELSE 0 END AS `XXS#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XS') THEN temp.template ELSE 0 END AS `XS#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XS') THEN temp.garment ELSE 0 END AS `XS#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XS') THEN temp.washing ELSE 0 END AS `XS#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'S') THEN temp.template ELSE 0 END AS `S#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'S') THEN temp.garment ELSE 0 END AS `S#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'S') THEN temp.washing ELSE 0 END AS `S#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'M') THEN temp.template ELSE 0 END AS `M#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'M') THEN temp.garment ELSE 0 END AS `M#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'M') THEN temp.washing ELSE 0 END AS `M#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'L') THEN temp.template ELSE 0 END AS `L#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'L') THEN temp.garment ELSE 0 END AS `L#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'L') THEN temp.washing ELSE 0 END AS `L#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XL') THEN temp.template ELSE 0 END AS `XL#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XL') THEN temp.garment ELSE 0 END AS `XL#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XL') THEN temp.washing ELSE 0 END AS `XL#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXL') THEN temp.template ELSE 0 END AS `XXL#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXL') THEN temp.garment ELSE 0 END AS `XXL#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXL') THEN temp.washing ELSE 0 END AS `XXL#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXL') THEN temp.template ELSE 0 END AS `XXXL#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXL') THEN temp.garment ELSE 0 END AS `XXXL#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXL') THEN temp.washing ELSE 0 END AS `XXXL#洗后尺寸`,

        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXXL') THEN temp.template ELSE 0 END AS `XXXXL#样衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXXL') THEN temp.garment ELSE 0 END AS `XXXXL#成衣尺寸`,
        CASE WHEN (1 &lt;&gt; 1 OR BINARY temp.internal_size = 'XXXXL') THEN temp.washing ELSE 0 END AS `XXXXL#洗后尺寸`

        from (select ts.id,
        t.foreign_id,
        ts.brand_name,
        tsc.style_no,
        tsc.style_color_pic,
        tsc.color_name,
        ts.year_name,
        ts.season_name,
        ts.band_name,
        ts.prod_category1st_name,
        ts.prod_category_name,
        ts.prod_category2nd_name,
        ts.prod_category3rd_name,
        t.part_name,
        t.method,
        tbs.internal_size,
        tpsd.template,
        tpsd.garment,
        tpsd.washing
        from t_pack_size t
        LEFT JOIN t_pack_info t1 ON t.foreign_id = t1.id and t1.del_flag = 0
        LEFT JOIN t_style_color tsc ON tsc.id = t1.style_color_id and tsc.del_flag = 0
        LEFT JOIN t_style ts ON ts.id = tsc.style_id and ts.del_flag = 0
        LEFT JOIN t_pack_size_detail tpsd ON t.id = tpsd.pack_size_id and tpsd.del_flag = 0
        LEFT JOIN t_basicsdatum_size tbs  ON FIND_IN_SET(tbs.id, ts.size_ids) > 0 AND tpsd.size = tbs.hangtags and tbs.del_flag = 0
        ${ew.customSqlSegment} ) temp) t

        GROUP BY
        t.brand_name,
        t.style_no,
        t.style_color_pic,
        t.color_name,
        t.year_name,
        t.season_name,
        t.band_name,
        t.prod_category1st_name,
        t.prod_category_name,
        t.prod_category2nd_name,
        t.prod_category3rd_name,
        t.part_name,
        t.method
    </select>

    <select id="getDesignOrderScheduleDetailsReport" resultType="com.base.sbc.module.report.vo.DesignOrderScheduleDetailsReportVo">
        select
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            tsc.id,
            tsc.devt_type_name,
            case when ts.band_name is not null then CONCAT(SUBSTRING(ts.band_name,1,length(ts.band_name) -1),'月')  else '' end as `month`,
            ts.brand_name,
            concat(ts.year,ts.season_name) yearSeason,
            SUBSTRING_INDEX(ts.designer, ',', 1) as designerName,
            ts.band_name ,
            ts.design_no,
            tsc.style_no,
            tsc.style_color_pic,
            tobd.commissioning_date,
            tsc.send_main_fabric_date,
            tsc.send_main_fabric_overdue_reason,
            tsc.design_detail_date,
            tsc.design_detail_overdue_reason,
            tsc.design_correct_date,
            tsc.design_correct_overdue_reason
        </if>
        FROM t_style_color tsc
        INNER JOIN t_style ts  ON  tsc.style_id = ts.id and ts.del_flag = 0
        LEFT JOIN t_order_book_detail tobd ON tsc.id = tobd.style_color_id and tobd.del_flag = 0
        ${ew.customSqlSegment}
    </select>

    <select id="getStyleSizeNewReport" resultType="com.base.sbc.module.report.vo.StyleSizeReportVo">
        select
        <if test="ew.sqlSelect != null and ew.sqlSelect != ''">
            ${ew.sqlSelect}
        </if>
        <if test="ew.sqlSelect == null or ew.sqlSelect == ''">
            tps.standard,
            ts.brand_name,
            tsc.style_no,
            tsc.style_color_pic,
            tsc.color_name,
            ts.year_name,
            ts.season_name,
            ts.band_name,
            ts.prod_category1st_name,
            ts.prod_category_name,
            ts.prod_category2nd_name,
            ts.prod_category3rd_name,
            tps.part_name,
            tps.method
        </if>
        from t_style ts
                 INNER JOIN t_style_color tsc ON ts.id = tsc.style_id and tsc.del_flag = 0
                 INNER JOIN t_pack_info tpi  ON  tsc.id = tpi.style_color_id and tpi.del_flag = 0
                 INNER JOIN t_pack_size tps  ON  tpi.id = tps.foreign_id and tps.del_flag = 0 and tps.pack_type = 'packBigGoods'
        ${ew.customSqlSegment}
    </select>
</mapper>