<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.base.sbc.module.style.mapper.StyleColorCorrectInfoMapper">

    <select id="findList" resultType="com.base.sbc.module.style.vo.StyleColorCorrectInfoVo">
        select
            tcci.*,
            tsc.*,
            CASE WHEN tsc.is_trim = '0' THEN tsma.style_no ELSE '' END as accessoryNo,
            CASE WHEN tsc.is_trim = '0' THEN tsma.color_name ELSE'' END as accessory1,
            CASE WHEN tsc.is_trim  = '0' THEN ''ELSE tsma.style_no  END as principalStyleNo,
            CASE WHEN tsc.is_trim = '0' THEN ''ELSE tsma.color_name END as principalStyle,
            if(tsc.color_crash is null or tsc.color_crash = '', ts.color_crash, tsc.color_crash) as colorCrash,
            tpi.id packInfoId,
            tpi.name infoName,
            ts.task_level,
            ts.task_level_name,
            ts.style_type,
            ts.style_type_name,
            ts.size_range,
            ts.size_range_name,
            ts.merch_design_name,
            ts.pattern_design_name,
            ts.id  styleId,
            ts.style_pic,
            ts.design_no designNo,
            ts.prod_category1st,
            ts.prod_category1st_name,
            ts.prod_category,
            ts.prod_category_name,
            ts.his_design_no,
            ts.style_name,
            ts.designer_id,
            ts.designer,
            ts.technician_id,
            ts.technician_name,
            ts.brand,
            ts.brand_name,
            ts.year,
            ts.year_name,
            ts.season,
            ts.season_name,
            ts.prod_category2nd_name,
            ts.prod_category2nd,
            ts.prod_category3rd,
            ts.prod_category3rd_name,
            tsp.control_confirm,
            tsp.product_hangtag_confirm,
            tsp.control_hangtag_confirm,
            ts.devt_type as devtType,
            ts.devt_type_name as devtTypeName,
            concat(tsc.ware_code,tsc.color_code,tbs.sort) as defaultBarCode
        FROM
            t_style_color tsc
                LEFT JOIN t_style ts ON ts.id = tsc.style_id
                LEFT JOIN t_pack_info tpi on tpi.style_no = tsc.style_no
                LEFT JOIN t_style_pricing tsp on tsp.pack_id = tpi.id
                left join (SELECT style_color_id ,GROUP_CONCAT(style_no) style_no  ,GROUP_CONCAT(color_name) color_name ,is_trim FROM t_style_main_accessories WHERE del_flag='0' GROUP BY style_color_id)  tsma on (tsma.style_color_id = tsc.id )
                left join t_basicsdatum_size tbs ON FIND_IN_SET(tbs.id,ts.size_ids) > 0 and tbs.hangtags = ts.default_size
                left join t_style_color_correct_info tcci on tcci.style_id = tsc.id and tcci.del_flag = '0'
                WHERE NOT EXISTS (select 1 from t_style_color_correct_info WHERE style_id = tsc.id AND del_flag = '1')
            ${ew.customSqlSegment}

    </select>

</mapper>